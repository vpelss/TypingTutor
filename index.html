<!DOCTYPE html>
<html>
<head>
<meta name="description" content="Typing Tutor">    
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Typing Tutor</title>
  <style>
  body { background-color: gray; }
  .tocenter { text-align: center; }
   #letterdisplay { font-size: 25px; }
  #titletext { text-align: center; border-style: } 
  </style>
  <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
</head>
  
<body id='whole'>

<audio jcontrols id='myAudio'>
  <source src="https://www.emogic.com/TypingTutor/A.mp3" type="audio/wav">
Your browser does not support the audio element.
</audio>

<div>  
<pre id='titletext'>Typing Tutor</pre>
</div>

<form class='tocenter'>
  <input type='checkbox' id='nolettersound'> No Letter Audio
  <br>
  <input type='checkbox' id='noerrorsound'> No Error Audio
  <br>
<textarea id='inputtextbox' rows="4" cols="50">
Insert practice text you wish to type here. Place cursor where you want to start typing.
</textarea>  
<br>
<textarea id='outputtextbox' rows="4" cols="50" readOnly='true'>
</textarea>
<br> 
<input type='button' id='starttyping' value='Start Typing' onclick='focus_outputtextbox();'>
</form>

  <div id='letterdisplay' class='tocenter'></div>
<script> 
 
var startmessage = 'After inserting text to type (in first box) click "Start Typing" button.';
$('#letterdisplay').html( startmessage );   

function wholekeypress(event)
{
if ( ! $('#outputtextbox').is( ":focus" ) )
  {//don't record key presses in input box
  return 1;
  }

var letter = event.key;
lowercaseletter = letter.toLowerCase();   
 
//get current letter
var myElement = document.getElementById('inputtextbox');
var myElement2 = document.getElementById('outputtextbox');
var startPosition = myElement2.selectionStart;
  
//does not work in other browsers!!!!!!!!!!!!!!!
//var targetl = window.getSelection();
var targetletter = myElement2.value.substring(startPosition, startPosition+1); //ff + chrome
//var targetletter = mygetSelection();
  
if (targetletter === letter)
  {//we typed correct letter
  $('#letterdisplay').html(letter); 
  if ( document.getElementById('nolettersound').checked == false )
    {
    if ( ! (lowercaseletter in global_wav_url) )  
      { //we do not have letter in our url array, but it is a correct letter
      playAudio('tick');
      }
    else
      { //we know what it is
      playAudio(lowercaseletter);
      }
    }
 
  myElement2.selectionStart = startPosition + 1;
  myElement2.selectionEnd = startPosition + 2;
  myElement.selectionStart = startPosition + 1;
  myElement.selectionEnd = startPosition + 2;   
  }
 else
   {//we typed wrong letter
   if ( document.getElementById('noerrorsound').checked == false )
       {
       playAudio('error');
       }
   $('#letterdisplay').html('<font color="red">XXXXXXXXXXXXX</div>');
   } 
//refocus for IE. FU IE!!!!!
$('#outputtextbox').focus();
}
  
function wholekeyup(event)
{
$('#letterdisplay').html('&nbsp;');  
}
  
function focus_outputtextbox() 
{
change_displaybox();

var myElement = document.getElementById('inputtextbox');
var startPosition = myElement.selectionStart;

var myElement2 = document.getElementById('outputtextbox');
myElement2.selectionStart = startPosition;
myElement2.selectionEnd = startPosition + 1;

$( "#outputtextbox" ).focus();
$('#letterdisplay').html('Start typing where the highlighted cursor is.'); 
}
  
function change_displaybox()
{
//copy input text to output text
var t = $( "#inputtextbox" ).val( );
$( "#outputtextbox" ).val( t );
}
  
//bind event hanlers
$( "#whole" ).keypress( wholekeypress );
$( "#whole" ).keyup( wholekeyup );
$( "#inputtextbox" ).keypress(change_displaybox)
//$( "#inputtextbox" ).focusout( unfocus_inputtextbox );
 
$( "#inputtextbox" ).focusin( function(){$('#letterdisplay').html( startmessage )} );
$( "#outputtextbox" ).focusin( focus_outputtextbox );  
  
//sound url array  
var global_wav_url = {};
global_wav_url['a'] = 'https://www.emogic.com/TypingTutor/A.mp3';
global_wav_url['b'] = 'https://www.emogic.com/TypingTutor/B.mp3';
global_wav_url['c'] = 'https://www.emogic.com/TypingTutor/C.mp3';
global_wav_url['d'] = 'https://www.emogic.com/TypingTutor/D.mp3';
global_wav_url['e'] = 'https://www.emogic.com/TypingTutor/E.mp3';
global_wav_url['f'] = 'https://www.emogic.com/TypingTutor/F.mp3';
global_wav_url['g'] = 'https://www.emogic.com/TypingTutor/G.mp3';
global_wav_url['h'] = 'https://www.emogic.com/TypingTutor/H.mp3';
global_wav_url['i'] = 'https://www.emogic.com/TypingTutor/I.mp3';
global_wav_url['j'] = 'https://www.emogic.com/TypingTutor/J.mp3';
global_wav_url['k'] = 'https://www.emogic.com/TypingTutor/K.mp3';
global_wav_url['l'] = 'https://www.emogic.com/TypingTutor/L.mp3';
global_wav_url['m'] = 'https://www.emogic.com/TypingTutor/M.mp3';
global_wav_url['n'] = 'https://www.emogic.com/TypingTutor/N.mp3';
global_wav_url['o'] = 'https://www.emogic.com/TypingTutor/O.mp3';
global_wav_url['p'] = 'https://www.emogic.com/TypingTutor/P.mp3';
global_wav_url['q'] = 'https://www.emogic.com/TypingTutor/Q.mp3';
global_wav_url['r'] = 'https://www.emogic.com/TypingTutor/R.mp3';
global_wav_url['s'] = 'https://www.emogic.com/TypingTutor/S.mp3';
global_wav_url['t'] = 'https://www.emogic.com/TypingTutor/T.mp3';
global_wav_url['u'] = 'https://www.emogic.com/TypingTutor/U.mp3';
global_wav_url['v'] = 'https://www.emogic.com/TypingTutor/V.mp3';
global_wav_url['w'] = 'https://www.emogic.com/TypingTutor/W.mp3';
global_wav_url['x'] = 'https://www.emogic.com/TypingTutor/X.mp3';
global_wav_url['y'] = 'https://www.emogic.com/TypingTutor/Y.mp3';
global_wav_url['z'] = 'https://www.emogic.com/TypingTutor/Z.mp3';

global_wav_url['error'] = 'https://www.emogic.com/TypingTutor/Windows Error.mp3';
global_wav_url['tick'] = 'https://www.emogic.com/TypingTutor/ButtonRelease.mp3';

var speak = document.getElementById("myAudio"); 
function playAudio(letter) 
{ 
  if ( global_wav_url[letter] === undefined ) 
    {//nothing in array - default
    speak.src = 'https://www.emogic.com/TypingTutor/Z.mp3';
    }
  else
  {
  speak.src = global_wav_url[letter];
  }    
speak.play(); 
} 

function pauseAudio() 
{ 
speak.pause(); 
}
  
  //not used now
function mygetSelection() 
{
var selobj;
if (!!window.getSelection)   
  {
  selobj = window.getSelection();
  return selobj.text 
  }; //ie?
if (document.getSelection) 
  {
  selobj = document.getSelection();
  return selobj.toString()
  } ; //chrome

selobj = document.selection.createRange(); 
return ( selobj.text ); //ff?

//return (!!document.getSelection) ? document.getSelection() :
	      // (!!window.getSelection)   ? window.getSelection() :
	      // document.selection.createRange().text;
  
var userSelection;
if (window.getSelection) 
  {
	userSelection = window.getSelection();
  }
else if (document.selection) 
  { // should come last; Opera!
	userSelection = document.selection.createRange();
  }
  //ff userSelection
  //ie userSelection.text
  //
  
}
  
</script>

  </body>
</html>
