<!DOCTYPE html>
<html>
<head>
<meta name="description" content="Typing Tutor">    
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Typing Tutor</title>
  <style>
  body { background-color: gray; }
  .tocenter { text-align: center; }
   #letterdisplay { font-size: 25px; }
  #titletext { text-align: center; border-style: } 
  </style>
  <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
</head>
  
<body id='whole'>

<audio jcontrols id='myAudio'>
  <source src="https://evolution.voxeo.com/library/audio/prompts/alphabet/A.wav" type="audio/wav">
Your browser does not support the audio element.
</audio>

<div>  
<pre id='titletext'>Typing Tutor</pre>
</div>

<div id='letterdisplay' class='tocenter'></div>

<form class='tocenter'>
  <input type='checkbox' id='nolettersound'> No Letter Audio
  <br>
  <input type='checkbox' id='noerrorsound'> No Error Audio
  <br>
<textarea id='inputtextbox' rows="4" cols="50">
Insert practice text you wish to type here. Place cursor where you want to start typing.
</textarea>  
<br>
<textarea id='outputtextbox' rows="4" cols="50" readOnly='true'>
</textarea>
<br> 
<input type='button' id='starttyping' value='Start Typing' onclick='unfocus_inputtextbox();'>
</form>

<script> 
 
var startmessage = 'After inserting text to type (in first box) click "Start Typing" button.';
$('#letterdisplay').html( startmessage );   
  
function wholekeypress(event)
{
if ( ! $('#outputtextbox').is( ":focus" ) )
  {//don't record key presses in input box
  return 1;
  }

var letter = event.key;
lowercaseletter = letter.toLowerCase();   
 
//get current letter
var myElement = document.getElementById('inputtextbox');
var myElement2 = document.getElementById('outputtextbox');
var startPosition = myElement2.selectionStart;
  
  //does not work in other browsers!!!!!!!!!!!!!!!
var targetl = window.getSelection();
  var targetletter = targetl.toString();
//var targetletter = document.selection.createRange().text;
  
if (targetletter === letter)
  {//we typed correct letter
  $('#letterdisplay').html(letter); 
  if ( document.getElementById('nolettersound').checked == false )
    {
    if ( ! (lowercaseletter in global_wav_url) )  
      { //we do not have it in our url array
      //beep (100,520,100); //beep
      playAudio('tick');
      }
    else
      { //we know what it is
      playAudio(lowercaseletter);
      }
    }
 
  myElement2.selectionStart = startPosition + 1;
  myElement2.selectionEnd = startPosition + 2;
  myElement.selectionStart = startPosition + 1;
  myElement.selectionEnd = startPosition + 2;   
  }
 else
   {//we typed wrong letter
   if ( document.getElementById('noerrorsound').checked == false )
       {
       playAudio('error');
       //beep (999,220,300); //boop
       }
   $('#letterdisplay').html('<font color="red">XXXXXXXXXXXXX</div>');
   } 
}
  
function wholekeyup(event)
{
$('#letterdisplay').html('&nbsp;');  
}
  
function unfocus_inputtextbox() 
{
change_displaybox();

var myElement = document.getElementById('inputtextbox');
var startPosition = myElement.selectionStart;

var myElement2 = document.getElementById('outputtextbox');
myElement2.selectionStart = startPosition;
myElement2.selectionEnd = startPosition + 1;

$( "#outputtextbox" ).focus();
$('#letterdisplay').html('Start typing where the highlighted cursor is.'); 
}
  
function change_displaybox()
{
//copy input text to output text
var t = $( "#inputtextbox" ).val( );
$( "#outputtextbox" ).val( t );
}
  
//bind event hanlers
$( "#whole" ).keypress( wholekeypress );
$( "#whole" ).keyup( wholekeyup );
$( "#inputtextbox" ).keypress(change_displaybox)
$( "#inputtextbox" ).focusout( unfocus_inputtextbox );
$( "#inputtextbox" ).focusin( function(){$('#letterdisplay').html( startmessage )} );
  
//sound url array  
//convert to mp3!!!
var global_wav_url = {};
global_wav_url['a'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/A.wav';
global_wav_url['b'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/B.wav';
global_wav_url['c'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/C.wav';
global_wav_url['d'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/D.wav';
global_wav_url['e'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/E.wav';
global_wav_url['f'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/F.wav';
global_wav_url['g'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/G.wav';
global_wav_url['h'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/H.wav';
global_wav_url['i'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/I.wav';
global_wav_url['j'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/J.wav';
global_wav_url['k'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/K.wav';
global_wav_url['l'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/L.wav';
global_wav_url['m'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/M.wav';
global_wav_url['n'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/N.wav';
global_wav_url['o'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/O.wav';
global_wav_url['p'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/P.wav';
global_wav_url['q'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/Q.wav';
global_wav_url['r'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/R.wav';
global_wav_url['s'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/S.wav';
global_wav_url['t'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/T.wav';
global_wav_url['u'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/U.wav';
global_wav_url['v'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/V.wav';
global_wav_url['w'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/W.wav';
global_wav_url['x'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/X.wav';
global_wav_url['y'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/Y.wav';
global_wav_url['z'] = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/Z.wav';

global_wav_url['error'] = 'https://www.emogic.com/TypingTutor/Windows Error.wav';
global_wav_url['tick'] = 'https://www.emogic.com/TypingTutor/ButtonRelease.wav';

var speak = document.getElementById("myAudio"); 
function playAudio(letter) 
{ 
  if ( global_wav_url[letter] === undefined ) 
    {//nothing in array - default
    speak.src = 'https://evolution.voxeo.com/library/audio/prompts/alphabet/Z.wav';
    }
  else
  {
  speak.src = global_wav_url[letter];
  }    
speak.play(); 
} 

function pauseAudio() 
{ 
speak.pause(); 
}
  
var a = new AudioContext() // browsers limit the number of concurrent audio contexts, so you better re-use'em

function beep(vol, freq, duration){
  v=a.createOscillator()
  u=a.createGain()
  v.connect(u)
  v.frequency.value=freq
  v.type="square"
  u.connect(a.destination)
  u.gain.value=vol*0.01
  v.start(a.currentTime)
  v.stop(a.currentTime+duration*0.001)
}
 
//beep (100,520,200); //beep
//beep (999,220,300); //boop
//beep (999,210,800);beep (999,500,800); //cool
  
</script>

  </body>
</html>
